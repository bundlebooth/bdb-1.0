<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>BundleBooth Packages</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <script type="text/javascript">
    (function(C,A,L){let p=function(a,ar){a.q.push(ar);};let d=C.document;C.Cal=C.Cal||function(){let cal=C.Cal;let ar=arguments;if(!cal.loaded){cal.ns={};cal.q=cal.q||[];d.head.appendChild(d.createElement("script")).src=A;cal.loaded=true;}if(ar[0]===L){const api=function(){p(api,arguments);};const namespace=ar[1];api.q=api.q||[];if(typeof namespace==="string"){cal.ns[namespace]=cal.ns[namespace]||api;p(cal.ns[namespace],ar);p(cal, ["initNamespace", namespace]);}else p(cal,ar);return;}p(cal,ar);};})(window,"https://app.cal.com/embed/embed.js","init");
  </script>
  <style>
    :root {
      --bb-blue: #333;
      --bb-red: #e74c3c;
      --bb-light: #f4f4f4;
      --bb-dark: #343a40;
      --bb-green: #2ecc71;
      --bb-secondary: #666;
      --bb-hover-grey: #4a5057;
    }
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: var(--bb-light);
      color: var(--bb-dark);
      line-height: 1.5;
    }
    .container {
      display: flex;
      min-height: 100vh;
      flex-wrap: nowrap;
    }
    aside {
      width: 280px;
      background: #fff;
      border-right: 1px solid #ddd;
      padding: 24px 20px;
      overflow-y: auto;
    }
    main {
      flex: 1;
      padding: 24px 20px;
      overflow-y: auto;
      background: var(--bb-light);
    }
    .filter-section {
      margin-bottom: 20px;
    }
    .filter-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
      padding: 8px 0;
    }
    .filter-header h3 {
      margin: 0;
      color: var(--bb-blue);
      font-size: 1.1rem;
    }
    .toggle-icon {
      font-size: 1rem;
      transition: transform 0.3s;
      width: 16px;
      text-align: center;
    }
    .toggle-icon.collapsed::before {
      content: '+';
    }
    .toggle-icon:not(.collapsed)::before {
      content: '−';
    }
    .filter-content {
      max-height: 500px;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
    .filter-content.collapsed {
      max-height: 0;
    }
    #equipment-filters:not(.collapsed),
    #equipment-filters-modal:not(.collapsed) {
      max-height: none;
      overflow: visible;
    }
    .filter-content label {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 12px;
      cursor: pointer;
      font-size: 14px;
      padding: 4px 0;
    }
    .filter-content label input[type="checkbox"] {
      appearance: none;
      width: 18px;
      height: 18px;
      border: 2px solid var(--bb-blue);
      border-radius: 4px;
      position: relative;
      flex-shrink: 0;
      margin-top: 3px;
    }
    .filter-content label input[type="checkbox"]:checked {
      background: var(--bb-blue);
    }
    .filter-content label input[type="checkbox"]:checked::after {
      content: '';
      position: absolute;
      inset: 4px;
      background: #fff;
      border-radius: 2px;
    }
    .filter-content label .tag {
      display: inline-block;
      margin-left: 5px;
      vertical-align: middle;
    }
    .sale-tag,
    .new-tag {
      font-size: 0.6rem;
      color: var(--bb-red);
      font-weight: 600;
      text-transform: uppercase;
      margin-left: 4px;
      position: relative;
      top: -2px;
    }
    #filters-horizontal {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: flex-end;
      margin-bottom: 24px;
      padding-bottom: 8px;
    }
    #filters-horizontal > div {
      display: flex;
      flex-direction: column;
      min-width: 120px;
      flex-grow: 1;
    }
    #filters-horizontal label {
      font-weight: 500;
      margin-bottom: 6px;
      font-size: 13px;
      color: #555;
    }
    select,
    input[type="number"] {
      padding: 10px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      width: 100%;
      background: #fff;
      -webkit-appearance: none;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    #packages-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }
    .package {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 4px 8px rgba(0,0,0,.06);
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp .6s forwards;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .package:active {
      transform: scale(0.98);
    }
    @keyframes fadeInUp {
      to { opacity: 1; transform: translateY(0) }
    }
    .package h3 {
      margin: 0;
      color: var(--bb-blue);
      font-size: 1.1rem;
      line-height: 1.3;
      display: inline-block;
      vertical-align: middle;
    }
    .package p.description {
      margin: 0;
      font-size: .9rem;
      color: #555;
    }
    .package p {
      margin: 0;
    }
    .price {
      font-size: 1rem;
    }
    .price.sale {
      color: var(--bb-green);
      font-weight: 600;
    }
    .price.no-sale {
      color: var(--bb-dark);
      font-weight: 400;
    }
    .discount {
      color: var(--bb-red);
      font-weight: 600;
      font-size: 0.9rem;
      margin-left: 5px;
    }
    .original-price {
      text-decoration: line-through;
      color: var(--bb-secondary);
      font-size: 0.9rem;
      margin-left: 5px;
    }
    .book-now-button {
      display: inline-block;
      margin-top: 12px;
      padding: 10px 16px;
      background: rgba(44, 62, 80, 0.1);
      color: var(--bb-blue);
      font-weight: normal;
      border-radius: 6px;
      text-decoration: none;
      transition: all .25s;
      font-size: 14px;
      border: none;
      cursor: pointer;
      width: 100%;
      text-align: center;
    }
    .book-now-button:hover,
    .book-now-button:focus {
      background: var(--bb-hover-grey);
      color: #fff;
      outline: none;
      transform: translateY(-2px);
    }
    .book-now-button:active {
      background: var(--bb-dark);
      color: #fff;
      transform: translateY(0);
    }
    .bundled-tag {
      background: #e8fce8;
      color: #2e7d32;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.8em;
      font-weight: 500;
      display: inline-block;
      margin-right: 5px;
    }
    .package-type-tag {
      display: inline-block;
      background: #e8f4fc;
      color: var(--bb-blue);
      padding: 3px 8px;
      border-radius: 4px;
      margin-right: 5px;
      font-size: 0.8em;
      font-weight: 500;
    }
    .equipment-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 0;
      padding-top: 8px;
    }
    .equipment-tags span {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: normal;
    }
    .equipment-tag-photo-booth {
      background: #e6f0fa;
      color: #1e3a8a;
    }
    .equipment-tag-360-video-booth {
      background: #e9f7e9;
      color: #1a4d1a;
    }
    .equipment-tag-waffle-booth {
      background: #fcf4e8;
      color: #7c2d12;
    }
    .equipment-tag-magazine-photo-booth-box {
      background: #f3e8ff;
      color: #4c1d95;
    }
    .equipment-tag-espresso-coffee-booth {
      background: #e6d9cb;
      color: #5c4033;
    }
    .equipment-tag-audio-guest-book {
      background: #fce7f3;
      color: #831843;
    }
    .equipment-tag-smoothies-booth {
      background: #fce7f3;
      color: #831843;
    }
    .equipment-tag-sparkler-boxes {
      background: #fff7cc;
      color: #5a4a00;
    }
    .equipment-tag-dry-ice-fog {
      background: #e0f7fa;
      color: #164e63;
    }
    .equipment-tag-laser-effect-first-dance {
      background: #e8ecef;
      color: #495057;
    }
    .package-note {
      font-size: .85rem;
      color: #666;
      margin: 0;
      font-style: normal;
    }
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin: 20px 0;
      padding: 10px 0;
    }
    .pagination button {
      width: 36px;
      height: 36px;
      border: 1px solid #ccc;
      background: rgba(44, 62, 80, 0.1);
      color: var(--bb-blue);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.25s;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    .pagination button:hover {
      background: var(--bb-hover-grey);
      color: #fff;
    }
    .pagination button:active {
      background: var(--bb-dark);
      color: #fff;
    }
    .pagination button:disabled {
      background: #e0e0e0;
      color: #ccc;
      cursor: not-allowed;
    }
    .pagination button svg {
      width: 16px;
      height: 16px;
    }
    .pagination-label {
      font-size: 14px;
      min-width: 100px;
      text-align: center;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: flex-start;
      justify-content: center;
      padding: 20px;
      opacity: 0;
      transition: opacity 0.3s ease;
      overflow-y: auto;
    }
    .modal.active {
      display: flex;
      opacity: 1;
    }
    .modal-content {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      position: absolute;
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
      transform: scale(0.8);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    .modal.active .modal-content {
      transform: scale(1);
      opacity: 1;
      transition-delay: 0.1s;
    }
    .modal-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(44, 62, 80, 0.1);
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--bb-blue);
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: all 0.25s;
    }
    .modal-close:hover {
      background: var(--bb-hover-grey);
      color: #fff;
    }
    .modal-close:active {
      background: var(--bb-dark);
      color: #fff;
    }
    .modal-content h3 {
      margin: 0;
      color: var(--bb-blue);
      font-size: 1.2rem;
      padding-right: 20px;
      display: inline-block;
      vertical-align: middle;
    }
    .modal-content p {
      margin: 0;
      font-size: .95rem;
      color: #555;
    }
    .modal-content .equipment-tags {
      margin: 0;
      padding-top: 8px;
    }
    .modal-content .package-note {
      font-size: .9rem;
      color: #666;
      font-style: normal;
    }
    .modal-content .book-now-button {
      margin-top: 16px;
    }
    .no-results {
      text-align: center;
      padding: 40px 20px;
      grid-column: 1 / -1;
    }
    .filter-fab {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--bb-secondary);
      color: #fff;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      transition: transform 0.3s, background 0.3s;
    }
    .filter-fab:hover {
      background: var(--bb-hover-grey);
      transform: scale(1.1);
    }
    .filter-fab svg {
      width: 24px;
      height: 24px;
      fill: #fff;
    }
    .apply-filters-button {
      display: none;
      padding: 10px 16px;
      background: var(--bb-blue);
      color: #fff;
      border-radius: 6px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      width: 100%;
      text-align: center;
      margin-top: 12px;
      transition: all .25s;
    }
    .apply-filters-button:hover {
      background: var(--bb-hover-grey);
      transform: translateY(-2px);
    }
    .apply-filters-button:active {
      background: var(--bb-dark);
      transform: translateY(0);
    }
    @media (max-width: 900px) {
      .container {
        flex-direction: column;
        min-height: auto;
      }
      aside {
        display: none;
      }
      .filter-fab {
        display: flex;
      }
      #filters-horizontal {
        display: none; /* Hide horizontal filters on mobile */
      }
      .filter-header {
        padding: 10px 0;
      }
      .filter-header h3,
      .package h3,
      .modal-content h3,
      .package-type-tag {
        color: var(--bb-dark);
      }
      .package {
        padding: 16px;
      }
      #filter-modal .modal-content {
        padding-top: 40px;
      }
      .apply-filters-button {
        display: block;
      }
    }
    @media (max-width: 600px) {
      #filters-horizontal > div {
        min-width: 100%;
      }
      #packages-container {
        grid-template-columns: 1fr;
      }
      .package h3 {
        font-size: 1rem;
      }
      #filter-modal .modal-content {
        width: 95%;
        padding: 15px;
        padding-top: 40px;
      }
    }
    @media (max-width: 400px) {
      .pagination-label {
        min-width: 80px;
        font-size: 13px;
      }
      .pagination button {
        width: 32px;
        height: 32px;
      }
      .package-type-tag,
      .equipment-tags span {
        font-size: 11px;
        padding: 3px 8px;
      }
      .sale-tag,
      .new-tag {
        font-size: 0.5rem;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <aside>
    <div class="filter-section">
      <div class="filter-header" data-filter="package-type">
        <h3>Package Type</h3>
        <span class="toggle-icon"></span>
      </div>
      <div id="package-type-filters" class="filter-content">
        <label><input type="checkbox" name="package-type" value="All" checked> All</label>
        <label><input type="checkbox" name="package-type" value="Bundle"> <span class="tag bundled-tag">Bundled</span></label>
        <label><input type="checkbox" name="package-type" value="Individual"> <span class="tag package-type-tag">Individual</span></label>
      </div>
    </div>
    <div class="filter-section">
      <div class="filter-header" data-filter="package-options">
        <h3>Package Options</h3>
        <span class="toggle-icon"></span>
      </div>
      <div id="package-options-filters" class="filter-content">
        <label><input type="checkbox" name="package-options" value="All" checked> All</label>
        <label><input type="checkbox" name="package-options" value="Sale"> <span class="tag sale-tag">On Sale!</span></label>
        <label><input type="checkbox" name="package-options" value="New"> <span class="tag new-tag">New!</span></label>
      </div>
    </div>
    <div class="filter-section">
      <div class="filter-header" data-filter="event-type">
        <h3>Event Type</h3>
        <span class="toggle-icon"></span>
      </div>
      <div id="event-type-filters" class="filter-content"></div>
    </div>
    <div class="filter-section">
      <div class="filter-header" data-filter="equipment">
        <h3>Services Type</h3>
        <span class="toggle-icon"></span>
      </div>
      <div id="equipment-filters" class="filter-content">
        <label><input type="checkbox" name="equipment" value="All" checked> All</label>
        <label><input type="checkbox" name="equipment" value="Photo Booth"> <span class="tag equipment-tag-photo-booth">Photo Booth</span></label>
        <label><input type="checkbox" name="equipment" value="360 Video Booth"> <span class="tag equipment-tag-360-video-booth">360 Video Booth</span></label>
        <label><input type="checkbox" name="equipment" value="Audio Guest Book"> <span class="tag equipment-tag-audio-guest-book">Audio Guest Book</span></label>
        <label><input type="checkbox" name="equipment" value="Magazine Booth Box"> <span class="tag equipment-tag-magazine-photo-booth-box">Magazine Booth Box</span></label>
        <label><input type="checkbox" name="equipment" value="Espresso & Coffee Booth"> <span class="tag equipment-tag-espresso-coffee-booth">Espresso & Coffee Booth</span></label>
        <label><input type="checkbox" name="equipment" value="Waffle Booth"> <span class="tag equipment-tag-waffle-booth">Waffle Booth</span></label>
        <label><input type="checkbox" name="equipment" value="Smoothies Booth"> <span class="tag equipment-tag-smoothies-booth">Smoothies Booth</span></label>
        <label><input type="checkbox" name="equipment" value="Sparkler Boxes"> <span class="tag equipment-tag-sparkler-boxes">Sparkler Boxes</span></label>
        <label><input type="checkbox" name="equipment" value="Dry Ice Fog"> <span class="tag equipment-tag-dry-ice-fog">Dry Ice (Fog Effect)</span></label>
        <label><input type="checkbox" name="equipment" value="Laser First Dance"> <span class="tag equipment-tag-laser-effect-first-dance">Laser First Dance</span></label>
      </div>
    </div>
    </aside>
    <main>
      <div class="filter-fab" id="filter-button">
        <svg viewBox="0 0 24 24" fill="#fff" class="filter-icon">
          <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
        </svg>
        <svg viewBox="0 0 24 24" fill="#fff" class="close-icon" style="display: none;">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </div>
      <div id="filters-horizontal" aria-label="Main filters">
        <div>
          <label for="guestFilter">Guests</label>
          <select id="guestFilter">
            <option value="">Any</option>
            <option value="50">50+</option>
            <option value="100">100+</option>
            <option value="150">150+</option>
            <option value="200">200+</option>
            <option value="250">250+</option>
            <option value="300">300+</option>
          </select>
        </div>
        <div>
          <label for="durationFilter">Duration (hrs)</label>
          <select id="durationFilter">
            <option value="">Any</option>
          </select>
        </div>
        <div>
          <label>Price Min (C$)</label>
          <input type="number" id="minPrice" placeholder="0" min="0">
        </div>
        <div>
          <label>Price Max (C$)</label>
          <input type="number" id="maxPrice" placeholder="4000" min="0">
        </div>
        <div>
          <label for="sortBy">Sort By</label>
          <select id="sortBy">
            <option value="">Select</option>
            <option value="price-desc">Most Expensive</option>
            <option value="price-asc">Least Expensive</option>
            <option value="date-newest">Date: Newest</option>
            <option value="date-oldest">Date: Oldest</option>
          </select>
        </div>
      </div>
      <div class="pagination" id="pagination-top"></div>
      <div id="packages-container" tabindex="0"></div>
      <div class="pagination" id="pagination-bottom"></div>
    </main>
</div>
<div id="package-modal" class="modal">
  <div class="modal-content">
    <button class="modal-close" title="Close">×</button>
    <div id="modal-body"></div>
  </div>
</div>
<div id="filter-modal" class="modal">
  <div class="modal-content">
    <button class="modal-close" title="Close">×</button>
    <div id="filter-modal-body">
      <div class="filter-section">
        <div class="filter-header" data-filter="package-type" data-modal>
          <h3>Package Type</h3>
          <span class="toggle-icon"></span>
        </div>
        <div id="package-type-filters-modal" class="filter-content">
          <label><input type="checkbox" name="package-type" value="All" checked> All</label>
          <label><input type="checkbox" name="package-type" value="Bundle"> <span class="tag bundled-tag">Bundled</span></label>
          <label><input type="checkbox" name="package-type" value="Individual"> <span class="tag package-type-tag">Individual</span></label>
        </div>
      </div>
      <div class="filter-section">
        <div class="filter-header" data-filter="package-options" data-modal>
          <h3>Package Options</h3>
          <span class="toggle-icon"></span>
        </div>
        <div id="package-options-filters-modal" class="filter-content">
          <label><input type="checkbox" name="package-options" value="All" checked> All</label>
          <label><input type="checkbox" name="package-options" value="Sale"> <span class="tag sale-tag">On Sale!</span></label>
          <label><input type="checkbox" name="package-options" value="New"> <span class="tag new-tag">New!</span></label>
        </div>
      </div>
      <div class="filter-section">
        <div class="filter-header" data-filter="event-type" data-modal>
          <h3>Event Type</h3>
          <span class="toggle-icon"></span>
        </div>
        <div id="event-type-filters-modal" class="filter-content"></div>
      </div>
      <div class="filter-section">
        <div class="filter-header" data-filter="equipment" data-modal>
          <h3>Services Type</h3>
          <span class="toggle-icon"></span>
        </div>
        <div id="equipment-filters-modal" class="filter-content">
          <label><input type="checkbox" name="equipment" value="All" checked> All</label>
          <label><input type="checkbox" name="equipment" value="Photo Booth"> <span class="tag equipment-tag-photo-booth">Photo Booth</span></label>
          <label><input type="checkbox" name="equipment" value="360 Video Booth"> <span class="tag equipment-tag-360-video-booth">360 Video Booth</span></label>
          <label><input type="checkbox" name="equipment" value="Audio Guest Book"> <span class="tag equipment-tag-audio-guest-book">Audio Guest Book</span></label>
          <label><input type="checkbox" name="equipment" value="Magazine Booth Box"> <span class="tag equipment-tag-magazine-photo-booth-box">Magazine Booth Box</span></label>
          <label><input type="checkbox" name="equipment" value="Espresso & Coffee Booth"> <span class="tag equipment-tag-espresso-coffee-booth">Espresso & Coffee Booth</span></label>
          <label><input type="checkbox" name="equipment" value="Waffle Booth"> <span class="tag equipment-tag-waffle-booth">Waffle Booth</span></label>
          <label><input type="checkbox" name="equipment" value="Smoothies Booth"> <span class="tag equipment-tag-smoothies-booth">Smoothies Booth</span></label>
          <label><input type="checkbox" name="equipment" value="Sparkler Boxes"> <span class="tag equipment-tag-sparkler-boxes">Sparkler Boxes</span></label>
          <label><input type="checkbox" name="equipment" value="Dry Ice Fog"> <span class="tag equipment-tag-dry-ice-fog">Dry Ice (Fog Effect)</span></label>
          <label><input type="checkbox" name="equipment" value="Laser First Dance"> <span class="tag equipment-tag-laser-effect-first-dance">Laser First Dance</span></label>
        </div>
      </div>
      <div class="filter-section">
        <div id="numeric-filters-modal" class="filter-content">
          <div id="filters-horizontal-modal" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;">
            <div><label for="guestFilterModal">Guests</label><select id="guestFilterModal"><option value="">Any</option><option value="50">50+</option><option value="100">100+</option><option value="150">150+</option><option value="200">200+</option><option value="250">250+</option><option value="300">300+</option></select></div>
            <div><label for="durationFilterModal">Duration (hrs)</label><select id="durationFilterModal"><option value="">Any</option></select></div>
            <div><label>Price Min (C$)</label><input type="number" id="minPriceModal" placeholder="0" min="0"></div>
            <div><label>Price Max (C$)</label><input type="number" id="maxPriceModal" placeholder="4000" min="0"></div>
            <div><label for="sortByModal">Sort By</label><select id="sortByModal"><option value="">Select</option><option value="price-desc">Most Expensive</option><option value="price-asc">Least Expensive</option><option value="date-newest">Date: Newest</option><option value="date-oldest">Date: Oldest</option></select></div>
          </div>
        </div>
        <button class="apply-filters-button" id="apply-filters">Apply Filters</button>
      </div>
    </div>
  </div>
</div>
<script>
  let bundles = [], currentPage = 1, filteredBundles = [];
  const ITEMS_PER_PAGE = 9;
  const equipmentClassMap = {
    'Photo Booth': 'equipment-tag-photo-booth',
    '360 Video Booth': 'equipment-tag-360-video-booth',
    'Audio Guest Book': 'equipment-tag-audio-guest-book',
    'Magazine Booth Box': 'equipment-tag-magazine-photo-booth-box',
    'Espresso & Coffee Booth': 'equipment-tag-espresso-coffee-booth',
    'Waffle Booth': 'equipment-tag-waffle-booth',
    'Smoothies Booth': 'equipment-tag-smoothies-booth',
    'Sparkler Boxes': 'equipment-tag-sparkler-boxes',
    'Dry Ice Fog': 'equipment-tag-dry-ice-fog',
    'Laser First Dance': 'equipment-tag-laser-effect-first-dance'
  };
  async function loadPackages() {
    try {
      const response = await fetch('https://raw.githubusercontent.com/bundlebooth/bdb-1.0/refs/heads/main/packages.json');
      if (!response.ok) throw new Error('Failed to fetch packages');
      bundles = await response.json();
      bundles.forEach(pkg => {
        const slug = pkg.slug || `fallback-${pkg.name.toLowerCase().replace(/\s+/g,'-')}`;
        Cal("init", slug, { origin: "https://cal.com" });
        Cal.ns[slug]("ui", { "hideEventTypeDetails": false, "layout": "month_view" });
      });
      const eventTypeContainer = document.getElementById('event-type-filters');
      const eventTypeModalContainer = document.getElementById('event-type-filters-modal');
      eventTypeContainer.innerHTML = '<label><input type="checkbox" name="event-type" value="All" checked> All</label>';
      eventTypeModalContainer.innerHTML = eventTypeContainer.innerHTML;
      [...new Set(bundles.flatMap(pkg => Array.isArray(pkg.eventType) ? pkg.eventType : [pkg.eventType]).filter(type => type && type !== 'All' && type.trim()))].forEach(type => {
        const label = `<label><input type="checkbox" name="event-type" value="${type}"> ${type}</label>`;
        eventTypeContainer.insertAdjacentHTML('beforeend', label);
        eventTypeModalContainer.insertAdjacentHTML('beforeend', label);
      });
      const durationSelect = document.getElementById('durationFilter');
      const durationSelectModal = document.getElementById('durationFilterModal');
      for (let i = 1; i <= 50; i++) {
        durationSelect.insertAdjacentHTML('beforeend', `<option value="${i}">${i}</option>`);
        durationSelectModal.insertAdjacentHTML('beforeend', `<option value="${i}">${i}</option>`);
      }
      filterPackages();
      initializeFilterSections();
    } catch (error) {
      console.error('Error loading packages:', error);
      document.getElementById('packages-container').innerHTML = '<div class="no-results"><p>Unable to load packages. Please try again later.</p></div>';
    }
  }
  const selectors = {
    packages: '#packages-container',
    paginationTop: '#pagination-top',
    paginationBottom: '#pagination-bottom',
    guest: ['#guestFilter', '#guestFilterModal'],
    duration: ['#durationFilter', '#durationFilterModal'],
    minPrice: ['#minPrice', '#minPriceModal'],
    maxPrice: ['#maxPrice', '#maxPriceModal'],
    sortBy: ['#sortBy', '#sortByModal'],
    equipment: '#equipment-filters input[type=checkbox],#equipment-filters-modal input[type=checkbox]',
    eventType: '#event-type-filters input[type=checkbox],#event-type-filters-modal input[type=checkbox]',
    packageType: '#package-type-filters input[type=checkbox],#package-type-filters-modal input[type=checkbox]',
    packageOptions: '#package-options-filters input[type=checkbox],#package-options-filters-modal input[type=checkbox]',
    headers: '.filter-header',
    modal: '#package-modal',
    modalBody: '#modal-body',
    modalClose: '.modal-close',
    filterButton: '#filter-button',
    filterModal: '#filter-modal',
    applyFilters: '#apply-filters'
  };
  const els = {
    packages: document.querySelector(selectors.packages),
    paginationTop: document.querySelector(selectors.paginationTop),
    paginationBottom: document.querySelector(selectors.paginationBottom),
    guestSelector: selectors.guest.map(id => document.querySelector(id)),
    durationSelector: selectors.duration.map(id => document.querySelector(id)),
    minPriceSelector: selectors.minPrice.map(id => document.querySelector(id)),
    maxPriceSelector: selectors.maxPrice.map(id => document.querySelector(id)),
    sortBySelector: selectors.sortBy.map(id => document.querySelector(id)),
    equipment: document.querySelectorAll(selectors.equipment),
    eventType: document.querySelectorAll(selectors.eventType),
    packageType: document.querySelectorAll(selectors.packageType),
    packageOptions: document.querySelectorAll(selectors.packageOptions),
    headers: document.querySelectorAll(selectors.headers),
    modal: document.querySelector(selectors.modal),
    modalBody: document.querySelector(selectors.modalBody),
    modalClose: document.querySelectorAll(selectors.modalClose),
    filterButton: document.querySelector(selectors.filterButton),
    filterModal: document.querySelector(selectors.filterModal),
    applyFilters: document.querySelector(selectors.applyFilters)
  };
  function syncFilters(source, target, isModal) {
    target.value = source.value;
    filterPackages();
  }
  els.guestSelector.forEach((el, i) => el.addEventListener('change', () => syncFilters(el, els.guestSelector[i ? 0 : 1], i)));
  els.durationSelector.forEach((el, i) => el.addEventListener('change', () => syncFilters(el, els.durationSelector[i ? 0 : 1], i)));
  els.minPriceSelector.forEach((el, i) => el.addEventListener('input', () => syncFilters(el, els.minPriceSelector[i ? 0 : 1], i)));
  els.maxPriceSelector.forEach((el, i) => el.addEventListener('input', () => syncFilters(el, els.maxPriceSelector[i ? 0 : 1], i)));
  els.sortBySelector.forEach((el, i) => el.addEventListener('change', () => syncFilters(el, els.sortBySelector[i ? 0 : 1], i)));
  function renderPackages(list, page = 1) {
    els.packages.innerHTML = list.length ? '' : '<div class="no-results"><p>No matching packages found. <br> Try adjusting your filters or <a href="https://bundlebooth.ca/contact" target="_blank" rel="noopener noreferrer">contact us</a> to create a personalized bundle.</p></div>';
    if (!list.length) {
      els.paginationTop.innerHTML = els.paginationBottom.innerHTML = '';
      return;
    }
    const start = (page - 1) * ITEMS_PER_PAGE;
    list.slice(start, start + ITEMS_PER_PAGE).forEach((pkg, i) => {
      const slug = pkg.slug || `fallback-${pkg.name.toLowerCase().replace(/\s+/g,'-')}`;
      const isSale = pkg.Sale === "Y", isNew = pkg.New === "Y";
      const priceClass = isSale ? 'price sale' : 'price no-sale';
      const priceDetails = isSale ? `<span class="${priceClass}">$${pkg.price}</span><span class="original-price">(Reg. $${pkg.regPrice})</span> - <span class="discount">${pkg.discount}% OFF!</span>` : `<span class="${priceClass}">$${pkg.price}</span>`;
      const statusTags = (isSale ? '<span class="sale-tag">ON SALE!</span>' : '') + (isNew ? '<span class="new-tag">NEW!</span>' : '');
      const displayType = pkg.packageType === 'Bundle' ? 'Bundled' : pkg.packageType;
      const tagClass = pkg.packageType === 'Bundle' ? 'bundled-tag' : 'package-type-tag';
      const div = document.createElement('div');
      div.className = 'package';
      div.dataset.index = start + i;
      div.innerHTML = `
        <h3>${pkg.name}${statusTags}</h3>
        <span class="${tagClass}">${displayType}</span>
        <p class="description">${pkg.description}</p>
        <p><strong>Guests:</strong> ${pkg.guests}</p>
        <p><strong>Duration:</strong> ${pkg.packageType === 'Individual' ? '' : 'Up to '}${pkg.maxDuration ? `${pkg.maxDuration} ${pkg.maxDuration === 1 ? 'hour' : 'hours'}` : 'N/A'}</p>
        <p><strong>Price:</strong> ${priceDetails}</p>
        <p><strong>Services Included:</strong></p>
        <div class="equipment-tags">${pkg.equipment.map(item => `<span class="${equipmentClassMap[item] || 'equipment-tag-photo-booth'}">${item}</span>`).join('')}</div>
        <p class="package-note">${pkg.note}</p>
        <button class="book-now-button" data-cal-link="bundleboothca/${slug}" data-cal-namespace="${slug}" data-cal-config='{"layout":"month_view"}'>Book Now</button>
      `;
      div.addEventListener('click', e => !e.target.closest('.book-now-button') && openModal(pkg, div));
      div.querySelector('.book-now-button').addEventListener('click', handleBookNow);
      els.packages.appendChild(div);
    });
    renderPagination(list.length, page);
  }
  function handleBookNow(e) {
    if (window.matchMedia("(max-width: 900px)").matches) {
      const calLink = e.target.closest('.book-now-button').getAttribute('data-cal-link');
      if (calLink) window.open(`https://cal.com/${calLink}`, '_blank');
      e.preventDefault();
    }
  }
  function renderPagination(total, page) {
    const totalPages = Math.ceil(total / ITEMS_PER_PAGE);
    if (totalPages <= 1) {
      els.paginationTop.innerHTML = els.paginationBottom.innerHTML = '';
      return;
    }
    const createPagination = (container, scroll) => {
      container.innerHTML = '';
      const prev = document.createElement('button');
      prev.innerHTML = '<svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6" stroke="#333" stroke-width="2" stroke-linecap="round"/></svg>';
      prev.disabled = page === 1;
      prev.addEventListener('click', () => {
        if (page > 1) {
          currentPage--;
          renderPackages(filteredBundles, currentPage);
          if (scroll) els.packages.scrollIntoView({ behavior: 'smooth' });
        }
      });
      const next = document.createElement('button');
      next.innerHTML = '<svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6" stroke="#333" stroke-width="2" stroke-linecap="round"/></svg>';
      next.disabled = page === totalPages;
      next.addEventListener('click', () => {
        if (page < totalPages) {
          currentPage++;
          renderPackages(filteredBundles, currentPage);
          if (scroll) els.packages.scrollIntoView({ behavior: 'smooth' });
        }
      });
      const pageInfo = document.createElement('span');
      pageInfo.className = 'pagination-label';
      pageInfo.textContent = `Page ${page} of ${totalPages}`;
      container.append(prev, pageInfo, next);
    };
    createPagination(els.paginationTop, false);
    createPagination(els.paginationBottom, true);
  }
  function openModal(pkg, el) {
    const slug = pkg.slug || `fallback-${pkg.name.toLowerCase().replace(/\s+/g,'-')}`;
    const isSale = pkg.Sale === "Y", isNew = pkg.New === "Y";
    const priceClass = isSale ? 'price sale' : 'price no-sale';
    const priceDetails = isSale ? `<span class="${priceClass}">$${pkg.price}</span> (<span class="original-price">Reg. $${pkg.regPrice})</span>) - <span class="discount">${pkg.discount}% OFF!</span>` : `<span class="${priceClass}">$${pkg.price}</span>`;
    const statusTags = (isSale ? '<span class="sale-tag">ON SALE!</span>' : '') + (isNew ? '<span class="new-tag">NEW!</span>' : '');
    const displayType = pkg.packageType === 'Bundle' ? 'Bundled' : pkg.packageType;
    const tagClass = pkg.packageType === 'Bundle' ? 'bundled-tag' : 'package-type-tag';
    els.modalBody.innerHTML = `
      <h3>${pkg.name}${statusTags}</h3>
      <div><span class="${tagClass}">${displayType}</span></div>
      <p class="description"><strong>Description:</strong> ${pkg.description}</p>
      <p><strong>Guests:</strong> ${pkg.guests}</p>
      <p><strong>Duration:</strong> ${pkg.packageType === 'Individual' ? '' : 'Up to '}${pkg.maxDuration ? `${pkg.maxDuration} ${pkg.maxDuration === 1 ? 'hour' : 'hours'}` : 'N/A'}</p>
      <p><strong>Price:</strong> ${priceDetails}</p>
      <p><strong>Services Included:</strong></p>
      <div class="equipment-tags">${pkg.equipment.map(item => `<span class="${equipmentClassMap[item] || 'equipment-tag-photo-booth'}">${item}</span>`).join('')}</div>
      <p class="package-note"><strong>Note:</strong> ${pkg.note}</p>
      <button class="book-now-button" data-cal-link="bundleboothca/${slug}" data-cal-namespace="${slug}" data-cal-config='{"layout":"month_view"}'>Book Now</button>
    `;
    els.modalBody.querySelector('.book-now-button').addEventListener('click', handleBookNow);
    els.modal.style.display = 'flex';
    setTimeout(() => els.modal.classList.add('active'), 10);
    const rect = el.getBoundingClientRect();
    const modalContent = els.modal.querySelector('.modal-content');
    modalContent.style.cssText = `position:absolute;top:${rect.top + (window.scrollY || window.pageYOffset) - 20}px;left:50%;transform:translateX(-50%) scale(1);`;
  }
  function closeModal(modal) {
    modal.classList.remove('active');
    setTimeout(() => {
      modal.style.display = 'none';
      if (modal.id === 'package-modal') els.modalBody.innerHTML = '';
      const modalContent = modal.querySelector('.modal-content');
      modalContent.style.cssText = '';
      if (modal.id === 'filter-modal') {
        els.filterButton.querySelector('.filter-icon').style.display = 'block';
        els.filterButton.querySelector('.close-icon').style.display = 'none';
      }
    }, 300);
  }
  els.modalClose.forEach(btn => btn.addEventListener('click', () => closeModal(btn.closest('.modal'))));
  els.modal.addEventListener('click', e => e.target === els.modal && closeModal(els.modal));
  els.filterModal.addEventListener('click', e => e.target === els.filterModal && closeModal(els.filterModal));
  els.filterButton.addEventListener('click', () => {
    const isModalOpen = els.filterModal.style.display === 'flex';
    if (isModalOpen) {
      closeModal(els.filterModal);
    } else {
      els.filterModal.style.display = 'flex';
      setTimeout(() => {
        els.filterModal.classList.add('active');
        els.filterButton.querySelector('.filter-icon').style.display = 'none';
        els.filterButton.querySelector('.close-icon').style.display = 'block';
      }, 10);
      const modalContent = els.filterModal.querySelector('.modal-content');
      modalContent.style.cssText = 'position:absolute;top:20px;left:50%;transform:translateX(-50%) scale(1);';
    }
  });
  els.applyFilters.addEventListener('click', () => {
    closeModal(els.filterModal);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
  function syncCheckboxes(filterType, changed) {
    const isModal = changed.closest('#filter-modal');
    const sourcePrefix = isModal ? '-modal' : '', targetPrefix = isModal ? '' : '-modal';
    document.querySelectorAll(`#${filterType}-filters${sourcePrefix} input[type=checkbox]`).forEach((s, i) => {
      document.querySelectorAll(`#${filterType}-filters${targetPrefix} input[type=checkbox]`)[i].checked = s.checked;
    });
  }
  function filterPackages() {
    currentPage = 1;
    let filtered = bundles.slice();
    const selected = {
      packageOptions: Array.from(els.packageOptions).filter(i => i.checked).map(i => i.value),
      eventType: Array.from(els.eventType).filter(i => i.checked).map(i => i.value),
      packageType: Array.from(els.packageType).filter(i => i.checked).map(i => i.value),
      equipment: Array.from(els.equipment).filter(i => i.checked).map(i => i.value)
    };
    if (selected.packageOptions.length && !selected.packageOptions.includes("All")) {
      filtered = filtered.filter(pkg => selected.packageOptions.includes("Sale") && pkg.Sale === "Y" || selected.packageOptions.includes("New") && pkg.New === "Y");
    }
    if (selected.eventType.length && !selected.eventType.includes("All")) {
      filtered = filtered.filter(pkg => selected.eventType.some(type => (Array.isArray(pkg.eventType) ? pkg.eventType : [pkg.eventType]).includes(type)));
    }
    if (selected.packageType.length && !selected.packageType.includes("All")) {
      filtered = filtered.filter(pkg => selected.packageType.includes(pkg.packageType));
    }
    if (selected.equipment.length && !selected.equipment.includes("All")) {
      filtered = filtered.filter(pkg => selected.equipment.every(eq => pkg.equipment.includes(eq)));
    }
    if (els.guestSelector[0].value) filtered = filtered.filter(pkg => pkg.guests >= parseInt(els.guestSelector[0].value));
    if (els.durationSelector[0].value) filtered = filtered.filter(pkg => pkg.maxDuration >= parseInt(els.durationSelector[0].value));
    if (els.minPriceSelector[0].value) filtered = filtered.filter(pkg => pkg.price >= parseFloat(els.minPriceSelector[0].value));
    if (els.maxPriceSelector[0].value) filtered = filtered.filter(pkg => pkg.price <= parseFloat(els.maxPriceSelector[0].value));
    switch (els.sortBySelector[0].value) {
      case 'price-desc': filtered.sort((a, b) => b.price - a.price); break;
      case 'price-asc': filtered.sort((a, b) => a.price - b.price); break;
      case 'date-newest': filtered = filtered.slice().reverse(); break;
    }
    filteredBundles = filtered;
    renderPackages(filtered, currentPage);
  }
  function updateAllCheckbox(filterType, changedCheckbox) {
    const isModal = changedCheckbox.closest('#filter-modal');
    const prefix = isModal ? '-modal' : '';
    const allCheckbox = document.querySelector(`#${filterType}-filters${prefix} input[value="All"]`);
    const otherCheckboxes = Array.from(document.querySelectorAll(`#${filterType}-filters${prefix} input[type=checkbox]`)).filter(cb => cb.value !== "All");
    if (changedCheckbox.value === "All") {
      otherCheckboxes.forEach(cb => cb.checked = changedCheckbox.checked);
    } else {
      if (changedCheckbox.checked) {
        allCheckbox.checked = false;
        if (otherCheckboxes.every(cb => cb.checked)) allCheckbox.checked = true;
      } else {
        allCheckbox.checked = false;
        if (!otherCheckboxes.some(cb => cb.checked)) allCheckbox.checked = true;
      }
    }
    syncCheckboxes(filterType, changedCheckbox);
    filterPackages();
  }
  function initializeFilterSections() {
    const filterSections = ['package-type', 'package-options', 'event-type', 'equipment'];
    filterSections.forEach(key => {
      const content = document.getElementById(`${key}-filters`);
      const contentModal = document.getElementById(`${key}-filters-modal`);
      const icon = document.querySelector(`.filter-header[data-filter="${key}"]:not([data-modal]) .toggle-icon`);
      const iconModal = document.querySelector(`.filter-header[data-filter="${key}"][data-modal] .toggle-icon`);
      if (window.matchMedia("(max-width: 900px)").matches) {
        if (content) content.classList.add('collapsed');
        if (contentModal) contentModal.classList.add('collapsed');
        if (icon) icon.classList.add('collapsed');
        if (iconModal) iconModal.classList.add('collapsed');
      } else {
        if (content) content.classList.remove('collapsed');
        if (contentModal) contentModal.classList.remove('collapsed');
        if (icon) icon.classList.remove('collapsed');
        if (iconModal) iconModal.classList.remove('collapsed');
      }
    });
  }
  function toggleFilterSection(id) {
    const content = document.getElementById(id);
    const isModal = id.includes('-modal');
    const filterKey = id.replace('-modal', '').replace('-filters', '');
    const icon = document.querySelector(`.filter-header[data-filter="${filterKey}"]${isModal ? '[data-modal]' : ':not([data-modal])'} .toggle-icon`);
    if (content && icon) {
      content.classList.toggle('collapsed');
      icon.classList.toggle('collapsed');
      const targetId = isModal ? id.replace('-modal', '') : `${id}-modal`;
      const targetContent = document.getElementById(targetId);
      const targetIcon = document.querySelector(`.filter-header[data-filter="${filterKey}"]${isModal ? ':not([data-modal])' : '[data-modal]'} .toggle-icon`);
      if (targetContent && targetIcon) {
        targetContent.classList.toggle('collapsed');
        targetIcon.classList.toggle('collapsed');
      }
    }
  }
  els.packageType.forEach(cb => cb.addEventListener('change', () => updateAllCheckbox('package-type', cb)));
  els.packageOptions.forEach(cb => cb.addEventListener('change', () => updateAllCheckbox('package-options', cb)));
  els.eventType.forEach(cb => cb.addEventListener('change', () => updateAllCheckbox('event-type', cb)));
  els.equipment.forEach(cb => cb.addEventListener('change', () => updateAllCheckbox('equipment', cb)));
  els.headers.forEach(h => {
    const toggle = (e) => {
      e.preventDefault();
      e.stopPropagation();
      const key = h.dataset.filter;
      const isModal = h.hasAttribute('data-modal') ? '-modal' : '';
      toggleFilterSection(`${key}-filters${isModal}`);
    };
    h.addEventListener('click', toggle);
    h.addEventListener('touchstart', toggle, { passive: false });
  });
  document.addEventListener('DOMContentLoaded', loadPackages);
</script>
</body>
</html>

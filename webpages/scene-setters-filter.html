<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Special Effects Packages - BundleBooth</title>
  <style>
    :root {
      --bb-blue: #2c3e50;
      --bb-red: #e74c3c;
      --bb-light: #f8f9fa;
      --bb-dark: #343a40;
      --bb-primary: #3498db;
      --bb-secondary: #95a5a6;
      --bb-border: #e0e0e0;
      --bb-green: #27ae60;
      --bb-hover-grey: #4a5057;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Poppins', sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #fff;
      padding-bottom: 40px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    h2, h3 {
      font-weight: 600;
      color: var(--bb-blue);
    }

    h2 {
      font-size: 1.8rem;
      margin-bottom: 20px;
    }

    h3 {
      font-size: 1.3rem;
      margin-bottom: 15px;
    }

    .booth-options {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .booth-option {
      cursor: pointer;
      padding: 8px 16px;
      background: rgba(44, 62, 80, 0.1);
      border-radius: 6px;
      font-size: 0.9rem;
      color: var(--bb-blue);
      transition: background 0.3s ease, color 0.3s ease;
    }

    .booth-option:hover {
      background: var(--bb-hover-grey);
      color: #fff;
    }

    .booth-option.active {
      background: var(--bb-dark);
      color: #fff;
      font-weight: 500;
    }

    .booth-grid {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      gap: 30px;
      padding: 20px;
      position: relative;
      margin-bottom: 30px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
      user-select: none;
      touch-action: pan-x;
    }

    .booth-grid::-webkit-scrollbar {
      display: none;
    }

    .booth-container {
      flex: 0 0 calc(50% - 15px);
      min-width: calc(50% - 15px);
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid var(--bb-border);
      scroll-snap-align: start;
      position: relative;
    }

    .booth-container::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to left, rgba(255,255,255,0.9), transparent);
      pointer-events: none;
      opacity: 1;
      transition: opacity 0.3s ease;
    }

    .booth-container.no-fade::after {
      opacity: 0;
    }

    .booth-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    .image-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 300px;
      padding: 20px 0;
      background: linear-gradient(135deg, #FFFFFF 0%, #F5F6F5 100%);
    }

    .booth-image {
      width: 250px;
      height: 250px;
      object-fit: cover;
      border-radius: 50%;
      border: 5px solid white;
      box-shadow: 0 3px 10px rgba(192,192,192,0.3);
    }

    .booth-content {
      padding: 25px;
      padding-top: 15px;
    }

    .booth-description {
      margin-bottom: 20px;
      color: #555;
      font-size: 0.95rem;
    }

    .slideshow-container {
      position: relative;
      font-family: 'Poppins', sans-serif;
      margin-top: 20px;
    }

    .slideshow-header {
      font-size: 1.1rem;
      font-weight: 500;
      color: var(--bb-blue);
      margin-bottom: 10px;
    }

    .slide {
      display: none;
      background: #fff;
      border: 1px solid var(--bb-border);
      border-radius: 8px;
      padding: 15px;
      animation: fadeIn 0.5s ease-in-out;
    }

    .slide.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .slide h4 {
      margin: 0 0 10px;
      color: var(--bb-blue);
      font-size: 1.1rem;
      display: inline-block;
      vertical-align: middle;
    }

    .sale-tag {
      font-size: 0.6rem;
      color: var(--bb-red);
      vertical-align: super;
      font-weight: 600;
      margin-left: 4px;
      text-transform: uppercase;
    }

    .new-tag {
      font-size: 0.6rem;
      color: var(--bb-red);
      vertical-align: super;
      font-weight: 600;
      margin-left: 4px;
      text-transform: uppercase;
    }

    .slide p {
      margin: 8px 0;
      font-size: 0.9rem;
      color: #555;
      line-height: 1.5;
    }

    .price {
      font-weight: 600;
      color: var(--bb-red);
      font-size: 0.9rem;
    }

    .price.no-sale {
      font-weight: 400;
      color: #555;
      font-size: 0.9rem;
    }

    .original-price {
      text-decoration: line-through;
      color: var(--bb-secondary);
      font-size: 0.9rem;
      margin-left: 5px;
    }

    .discount {
      color: var(--bb-green);
      font-weight: 600;
      font-size: 0.9rem;
      margin-left: 5px;
    }

    .book-now-button {
      display: inline-block;
      margin-top: 12px;
      padding: 10px 16px;
      background: rgba(44, 62, 80, 0.1);
      color: var(--bb-blue);
      font-weight: 500;
      border-radius: 6px;
      text-decoration: none;
      font-size: 14px;
      border: none;
      cursor: pointer;
      width: 100%;
      text-align: center;
      transition: all 0.25s;
      touch-action: manipulation;
    }

    .book-now-button:hover,
    .book-now-button:focus {
      background: var(--bb-hover-grey);
      color: #fff;
      transform: translateY(-2px);
      outline: none;
    }

    .book-now-button:active {
      background: var(--bb-dark);
      color: #fff;
      transform: translateY(0);
    }

    .browse-more-button {
      display: inline-block;
      margin-top: 12px;
      padding: 10px 20px;
      background: rgba(44, 62, 80, 0.1);
      color: var(--bb-blue);
      font-weight: 500;
      border-radius: 6px;
      text-decoration: none;
      font-size: 14px;
      transition: all 0.25s;
      border: none;
      cursor: pointer;
      touch-action: manipulation;
    }

    .browse-more-button:hover {
      background: var(--bb-hover-grey);
      color: #fff;
      transform: translateY(-2px);
    }

    .browse-more-button:active {
      background: var(--bb-dark);
      color: #fff;
      transform: translateY(0);
    }

    .book-now-wrapper {
      text-align: center;
      margin-top: 12px;
    }

    .slideshow-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
    }

    .slideshow-button {
      background: #fff;
      border: 1px solid var(--bb-border);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      cursor: pointer;
      transition: all 0.25s;
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
    }

    .slideshow-button:hover {
      background: #f5f5f5;
      transform: scale(1.1);
    }

    .slideshow-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .slide-indicator {
      font-size: 14px;
      color: var(--bb-dark);
      min-width: 60px;
      text-align: center;
    }

    .package-type-tag {
      display: inline-block;
      background: #e8f4fc;
      color: var(--bb-blue);
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.8em;
      font-weight: 500;
      margin-top: 5px;
      margin-bottom: 8px;
    }

    .bundled-tag {
      background: #e8fce8;
      color: #2e7d32;
    }

    .equipment-tag {
      display: inline-block;
      background: #f0f0f0;
      color: #333;
      padding: 3px 8px;
      border-radius: 4px;
      margin: 3px;
      font-size: 0.8em;
      font-weight: 500;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: var(--bb-secondary);
      font-style: italic;
    }

    .error-message {
      color: var(--bb-red);
      text-align: center;
      padding: 20px;
      font-weight: 500;
    }

    .package-details {
      margin: 10px 0;
    }

    .package-details p {
      margin: 5px 0;
      font-size: 0.9rem;
    }

    .price-container {
      display: flex;
      align-items: center;
      gap: 5px;
      flex-wrap: nowrap;
      white-space: nowrap;
    }

    .slideshow-note {
      font-family: 'Poppins', sans-serif;
      font-size: 0.8rem;
      color: var(--bb-secondary);
      text-align: center;
      margin: 10px 0;
    }

    @media (max-width: 900px) {
      .booth-options {
        display: none;
      }

      .booth-grid {
        display: grid;
        grid-template-columns: 1fr;
        grid-template-rows: auto;
        gap: 30px;
        padding: 0;
        overflow-x: hidden;
        scroll-snap-type: none;
      }

      .booth-container {
        min-width: 100%;
        max-width: 100%;
      }

      .booth-container::after {
        display: none;
      }
    }

    @media (max-width: 600px) {
      .booth-content {
        padding: 20px;
      }
      
      h2 {
        font-size: 1.5rem;
      }
      
      .booth-description {
        font-size: 0.9rem;
      }
      
      .slide h4 {
        font-size: 1rem;
      }
      
      .slide p {
        font-size: 0.85rem;
      }
      
      .image-container {
        height: 250px;
      }
      
      .booth-image {
        width: 200px;
        height: 200px;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Cal.com embed script -->
  <script type="text/javascript">
    (function (C, A, L) { 
      let p = function (a, ar) { a.q.push(ar); }; 
      let d = C.document; 
      C.Cal = C.Cal || function () { 
        let cal = C.Cal; 
        let ar = arguments; 
        if (!cal.loaded) { 
          cal.ns = {}; 
          cal.q = cal.q || []; 
          d.head.appendChild(d.createElement("script")).src = A; 
          cal.loaded = true; 
        } 
        if (ar[0] === L) { 
          const api = function () { p(api, arguments); }; 
          const namespace = ar[1]; 
          api.q = api.q || []; 
          if (typeof namespace === "string") {
            cal.ns[namespace] = cal.ns[namespace] || api;
            p(cal.ns[namespace], ar);
            p(cal, ["initNamespace", namespace]);
          } else p(cal, ar); 
          return;
        } 
        p(cal, ar); 
      }; 
    })(window, "https://app.cal.com/embed/embed.js", "init");
  </script>
</head>
<body>
  <div class="container">
    <div class="booth-options">
      <div class="booth-option active" data-booth="0">Sparklers Box</div>
      <div class="booth-option" data-booth="1">Dry Ice Fog</div>
      <div class="booth-option" data-booth="2">Laser First Dance</div>
    </div>
    <div class="booth-grid">
      <!-- Sparklers Box Section -->
      <div class="booth-container">
        <div class="image-container">
          <img src="https://img1.wsimg.com/isteam/ip/e5031132-8c20-44e3-a810-901cf200c927/rs%3Dw_1280%2Ch_1921.webp" alt="Sparklers Box" class="booth-image">
        </div>
        <div class="booth-content">
          <h2>✨ Sparklers Box</h2>
          <p class="booth-description">
            Light up your celebration with our elegant Sparklers Box! A stylish station offering guests premium sparklers for that magical photo moment or grand finale. Beautifully displayed and easy to use, it's the perfect touch for weddings, parties, and special events.
          </p>
          <div class="slideshow-header">Available Packages:</div>
          <div class="slideshow-container" id="sparklers-box-slideshow">
            <div class="loading">Loading Sparklers Box packages...</div>
          </div>
          <div class="slideshow-note">Go to Packages or tap 'Browse More' to view more options.</div>
          <div class="slideshow-controls">
            <button class="slideshow-button" id="sparklers-box-prev" aria-label="Previous Slide" disabled>
              <i class="fas fa-chevron-left"></i>
            </button>
            <span class="slide-indicator" id="sparklers-box-indicator">0 of 0</span>
            <button class="slideshow-button" id="sparklers-box-next" aria-label="Next Slide" disabled>
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          <div class="book-now-wrapper">
            <a href="https://bundlebooth.ca/packages" target="_blank" class="browse-more-button">Browse More</a>
          </div>
        </div>
      </div>
      
      <!-- Dry Ice Fog Section -->
      <div class="booth-container">
        <div class="image-container">
          <img src="https://img1.wsimg.com/isteam/ip/e5031132-8c20-44e3-a810-901cf200c927/rs%253Dw_1280%252Ch_1784.webp" alt="Dry Ice Fog" class="booth-image">
        </div>
        <div class="booth-content">
          <h2>🌫️ Dry Ice (Fog Effect)</h2>
          <p class="booth-description">
            Create a stunning, cinematic atmosphere with our Dry Ice Fog Effect! This low-lying fog adds a magical touch to first dances, stage entrances, or any moment you want to make unforgettable. Safe, odorless, and mesmerizing—perfect for weddings, parties, and live events.
          </p>
          <div class="slideshow-header">Available Packages:</div>
          <div class="slideshow-container" id="dry-ice-fog-slideshow">
            <div class="loading">Loading Dry Ice Fog packages...</div>
          </div>
          <div class="slideshow-note">Go to Packages or tap 'Browse More' to view more options.</div>
          <div class="slideshow-controls">
            <button class="slideshow-button" id="dry-ice-fog-prev" aria-label="Previous Slide" disabled>
              <i class="fas fa-chevron-left"></i>
            </button>
            <span class="slide-indicator" id="dry-ice-fog-indicator">0 of 0</span>
            <button class="slideshow-button" id="dry-ice-fog-next" aria-label="Next Slide" disabled>
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          <div class="book-now-wrapper">
            <a href="https://bundlebooth.ca/packages" target="_blank" class="browse-more-button">Browse More</a>
          </div>
        </div>
      </div>
      
      <!-- Laser First Dance Section -->
      <div class="booth-container">
        <div class="image-container">
          <img src="https://img1.wsimg.com/isteam/ip/e5031132-8c20-44e3-a810-901cf200c927/rs%3Dw_1920%2Cm.png" alt="Laser First Dance" class="booth-image">
        </div>
        <div class="booth-content">
          <h2>🪩 Laser First Dance</h2>
          <p class="booth-description">
            Make your first dance truly unforgettable with our Laser First Dance Experience! Set beneath a canopy of synchronized laser lights and dreamy effects, your special moment becomes a breathtaking visual masterpiece. Perfect for couples who want something unique, modern, and magical.
          </p>
          <div class="slideshow-header">Available Packages:</div>
          <div class="slideshow-container" id="laser-dance-slideshow">
            <div class="loading">Loading Laser First Dance packages...</div>
          </div>
          <div class="slideshow-note">Go to Packages or tap 'Browse More' to view more options.</div>
          <div class="slideshow-controls">
            <button class="slideshow-button" id="laser-dance-prev" aria-label="Previous Slide" disabled>
              <i class="fas fa-chevron-left"></i>
            </button>
            <span class="slide-indicator" id="laser-dance-indicator">0 of 0</span>
            <button class="slideshow-button" id="laser-dance-next" aria-label="Next Slide" disabled>
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          <div class="book-now-wrapper">
            <a href="https://bundlebooth.ca/packages" target="_blank" class="browse-more-button">Browse More</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Page loaded at:', new Date().toISOString()); // Debug: Confirm page load
      // Data source for packages
      const dataSource = 'https://raw.githubusercontent.com/bundlebooth/bdb-1.0/main/packages.json';

      // Fallback package data
      const fallbackPackages = [
        {
          name: "Sample Sparkler Boxes Package",
          equipment: ["Sparkler Boxes"],
          packageType: "Individual",
          price: 200,
          description: "A sample sparkler boxes package for display purposes.",
          guests: 50,
          maxDuration: 2,
          slug: "sparkler-boxes",
          Sale: "N",
          New: "Y"
        },
        {
          name: "Sample Dry Ice Fog Package",
          equipment: ["Dry Ice Fog"],
          packageType: "Individual",
          price: 300,
          originalPrice: 400,
          description: "A sample dry ice fog package for display purposes.",
          guests: 75,
          maxDuration: 3,
          slug: "dry-ice-fog",
          Sale: "Y",
          New: "N"
        },
        {
          name: "Sample Laser First Dance Package",
          equipment: ["Laser Effect for First Dance"],
          packageType: "Individual",
          price: 500,
          description: "A sample laser first dance package for display purposes.",
          guests: 100,
          maxDuration: 2,
          slug: "laser-first-dance",
          Sale: "N",
          New: "Y"
        }
      ];

      // Initialize Cal.com for each package's slug
      fallbackPackages.forEach(pkg => {
        const slug = pkg.slug || `fallback-${pkg.name.toLowerCase().replace(/\s+/g, '-')}`;
        const namespace = slug;
        Cal("init", namespace, { origin: "https://app.cal.com" });
        Cal.ns[namespace]("ui", {
          "hideEventTypeDetails": false,
          "layout": "month_view"
        });
      });

      // Initialize booth navigation and drag functionality
      const boothGrid = document.querySelector('.booth-grid');
      const boothOptions = document.querySelectorAll('.booth-option');
      const boothContainers = document.querySelectorAll('.booth-container');

      // Drag functionality
      let isDragging = false;
      let startX, scrollLeft, velocity = 0, lastTime = 0, lastX;

      function startDrag(e) {
        if (window.innerWidth <= 900) return; // Disable drag on mobile
        isDragging = true;
        boothGrid.style.cursor = 'grabbing';
        startX = (e.type === 'touchstart' ? e.touches[0].pageX : e.pageX) - boothGrid.offsetLeft;
        scrollLeft = boothGrid.scrollLeft;
        velocity = 0;
        lastTime = Date.now();
        lastX = startX;
        cancelMomentum();
      }

      function drag(e) {
        if (!isDragging) return;
        e.preventDefault();
        const x = (e.type === 'touchmove' ? e.touches[0].pageX : e.pageX) - boothGrid.offsetLeft;
        const walk = (x - startX) * 1.5; // Adjust drag sensitivity
        boothGrid.scrollLeft = scrollLeft - walk;

        // Calculate velocity for momentum
        const now = Date.now();
        const deltaTime = now - lastTime;
        if (deltaTime > 0) {
          velocity = (x - lastX) / deltaTime;
          lastX = x;
          lastTime = now;
        }
      }

      function endDrag() {
        if (!isDragging) return;
        isDragging = false;
        boothGrid.style.cursor = 'grab';
        applyMomentum();
        updateActiveOption();
      }

      let momentumId;
      function applyMomentum() {
        if (Math.abs(velocity) < 0.1) return;
        let currentScroll = boothGrid.scrollLeft;
        const momentum = velocity * 1000; // Scale velocity for momentum effect

        function animate() {
          currentScroll -= velocity * 16; // Approximate 60fps frame
          boothGrid.scrollLeft = currentScroll;
          velocity *= 0.95; // Friction
          if (Math.abs(velocity) > 0.01) {
            momentumId = requestAnimationFrame(animate);
          } else {
            snapToNearest();
          }
        }
        momentumId = requestAnimationFrame(animate);
      }

      function cancelMomentum() {
        if (momentumId) {
          cancelAnimationFrame(momentumId);
          momentumId = null;
        }
      }

      function snapToNearest() {
        const scrollLeft = boothGrid.scrollLeft;
        const containerWidth = boothContainers[0].offsetWidth + 30; // Include gap
        const index = Math.round(scrollLeft / containerWidth);
        boothGrid.scrollTo({
          left: index * containerWidth,
          behavior: 'smooth'
        });
        updateActiveOption();
      }

      function updateFadeEffect() {
        if (window.innerWidth > 900) {
          const gridRect = boothGrid.getBoundingClientRect();
          boothContainers.forEach((container, index) => {
            const rect = container.getBoundingClientRect();
            const isFullyVisible = rect.left >= gridRect.left && rect.right <= gridRect.right;
            container.classList.toggle('no-fade', isFullyVisible);
            if (index === boothContainers.length - 1 && isFullyVisible) {
              container.classList.add('no-fade');
            }
          });
        }
      }

      function updateActiveOption() {
        if (window.innerWidth <= 900) return;
        const scrollLeft = boothGrid.scrollLeft;
        const containerWidth = boothContainers[0].offsetWidth + 30; // Include gap
        const index = Math.round(scrollLeft / containerWidth);
        boothOptions.forEach(option => option.classList.remove('active'));
        if (boothOptions[index]) {
          boothOptions[index].classList.add('active');
        }
      }

      function scrollToBooth(index) {
        if (window.innerWidth <= 900) return;
        const booth = boothContainers[index];
        boothGrid.scrollTo({
          left: booth.offsetLeft - 30,
          behavior: 'smooth'
        });
        boothOptions.forEach(option => option.classList.remove('active'));
        boothOptions[index].classList.add('active');
      }

      boothOptions.forEach((option, index) => {
        option.addEventListener('click', () => {
          scrollToBooth(index);
        });
      });

      boothGrid.addEventListener('mousedown', startDrag);
      boothGrid.addEventListener('mousemove', drag);
      boothGrid.addEventListener('mouseup', endDrag);
      boothGrid.addEventListener('mouseleave', endDrag);
      boothGrid.addEventListener('touchstart', startDrag, { passive: false });
      boothGrid.addEventListener('touchmove', drag, { passive: false });
      boothGrid.addEventListener('touchend', endDrag);
      boothGrid.addEventListener('scroll', () => {
        updateFadeEffect();
        updateActiveOption();
      });
      window.addEventListener('resize', updateFadeEffect);

      if (window.innerWidth > 900) {
        boothGrid.style.cursor = 'grab';
        boothOptions[0].classList.add('active');
        updateFadeEffect();
      }

      // Fetch packages from JSON
      fetch(dataSource)
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status} ${response.statusText}`);
          }
          return response.json();
        })
        .then(allPackages => {
          console.log('Fetched packages:', allPackages);
          if (!Array.isArray(allPackages)) {
            throw new Error('Invalid data format: Expected an array of packages');
          }
          // Initialize Cal.com for fetched packages
          allPackages.forEach(pkg => {
            const slug = pkg.slug || `fallback-${pkg.name.toLowerCase().replace(/\s+/g, '-')}`;
            const namespace = slug;
            Cal("init", namespace, { origin: "https://app.cal.com" });
            Cal.ns[namespace]("ui", {
              "hideEventTypeDetails": false,
              "layout": "month_view"
            });
          });
          initSlideshows(allPackages);
        })
        .catch(error => {
          console.error('Error loading packages:', error.message);
          document.querySelectorAll('.slideshow-container').forEach(container => {
            container.innerHTML = `<div class="error-message">Failed to load packages: ${error.message}. Using fallback data.</div>`;
          });
          initSlideshows(fallbackPackages);
        });

      function initSlideshows(packages) {
        const slideshowConfigs = [
          {
            containerId: 'sparklers-box-slideshow',
            prevId: 'sparklers-box-prev',
            nextId: 'sparklers-box-next',
            indicatorId: 'sparklers-box-indicator',
            filter: 'Sparkler Boxes'
          },
          {
            containerId: 'dry-ice-fog-slideshow',
            prevId: 'dry-ice-fog-prev',
            nextId: 'dry-ice-fog-next',
            indicatorId: 'dry-ice-fog-indicator',
            filter: 'Dry Ice Fog'
          },
          {
            containerId: 'laser-dance-slideshow',
            prevId: 'laser-dance-prev',
            nextId: 'laser-dance-next',
            indicatorId: 'laser-dance-indicator',
            filter: 'Laser Effect for First Dance'
          }
        ];

        slideshowConfigs.forEach(config => {
          initSlideshowWithFilter(
            config.containerId,
            config.prevId,
            config.nextId,
            config.indicatorId,
            packages,
            config.filter
          );
        });
      }

      function initSlideshowWithFilter(containerId, prevId, nextId, indicatorId, allPackages, equipmentFilter) {
        const container = document.getElementById(containerId);
        const prevButton = document.getElementById(prevId);
        const nextButton = document.getElementById(nextId);
        const indicator = document.getElementById(indicatorId);
        
        let currentSlide = 0;
        let filteredPackages = [];
        let slides = []; // Store slide elements for toggling

        function filterAndSortPackages() {
          console.log(`Filtering packages for: ${equipmentFilter}`);
          filteredPackages = allPackages.filter(pkg => {
            if (!pkg.equipment || !Array.isArray(pkg.equipment)) {
              console.warn(`Package ${pkg.name} has invalid equipment field:`, pkg.equipment);
              return false;
            }
            return pkg.equipment.includes(equipmentFilter);
          }).map(pkg => ({
            ...pkg,
            originalPrice: pkg.regPrice || pkg.originalPrice || null,
            equipment: pkg.equipment ? [...pkg.equipment].sort((a, b) => {
              if (a === equipmentFilter) return -1;
              if (b === equipmentFilter) return 1;
              return a.localeCompare(b);
            }) : []
          }));

          console.log(`Filtered packages for ${equipmentFilter}:`, filteredPackages);

          filteredPackages.sort((a, b) => {
            if (a.packageType === 'Individual') return -1;
            if (b.packageType === 'Individual') return 1;
            return a.price - b.price;
          });
        }

        function calculateDiscount(price, originalPrice) {
          if (!originalPrice || originalPrice <= price || isNaN(price) || isNaN(originalPrice)) {
            return null;
          }
          const discount = ((originalPrice - price) / originalPrice) * 100;
          return Math.round(discount);
        }

        function renderSlides() {
          console.log(`Rendering slides for ${containerId}, currentSlide: ${currentSlide}`);
          
          if (filteredPackages.length === 0) {
            console.warn(`No packages found for ${equipmentFilter}`);
            container.innerHTML = '<div class="loading">No packages available for this equipment type.</div>';
            slides = [];
            prevButton.disabled = true;
            nextButton.disabled = true;
            indicator.textContent = '0 of 0';
            return;
          }

          // Render slides only if not already created
          if (slides.length === 0) {
            container.innerHTML = ''; // Clear loading message
            filteredPackages.forEach((pkg, index) => {
              const packageTypeClass = pkg.packageType === 'Bundle' ? 'bundled-tag' : '';
              const packageTypeDisplay = pkg.packageType === 'Bundle' ? 'Bundled' : 'Individual';
              const discount = pkg.originalPrice ? calculateDiscount(pkg.price, pkg.originalPrice) : null;
              const slug = pkg.slug || `fallback-${pkg.name.toLowerCase().replace(/\s+/g, '-')}`;
              const priceClass = discount ? 'price' : 'price no-sale';
              const isSale = pkg.Sale === 'Y';
              const isNew = pkg.New === 'Y';
              const statusTags = [];
              if (isSale) statusTags.push('<span class="sale-tag">ON SALE!</span>');
              if (isNew) statusTags.push('<span class="new-tag">NEW!</span>');
              
              console.log(`Creating slide for package: ${pkg.name}, Price: ${pkg.price}, OriginalPrice: ${pkg.originalPrice}, Discount: ${discount ? discount + '%' : 'None'}`);

              const slide = document.createElement('div');
              slide.className = `slide ${index === currentSlide ? 'active' : ''}`;
              const isMobile = window.innerWidth <= 900;
              const buttonTag = isMobile ? 'a' : 'button';
              const buttonAttributes = isMobile 
                ? `href="https://app.cal.com/bundleboothca/${slug}" target="_blank" rel="noopener noreferrer"`
                : `data-cal-link="bundleboothca/${slug}" data-cal-namespace="${slug}" data-cal-config='{"layout":"month_view"}'`;
              
              slide.innerHTML = `
                <h4>${pkg.name || 'Unnamed Package'}${statusTags.join('')}</h4>
                <p><span class="package-type-tag ${packageTypeClass}">${packageTypeDisplay}</span></p>
                ${pkg.description ? `<p>${pkg.description}</p>` : ''}
                
                <div class="package-details">
                  ${pkg.guests ? `<p><strong>Guests:</strong> Up to ${pkg.guests}</p>` : ''}
                  <p><strong>Duration:</strong> ${pkg.maxDuration ? (pkg.packageType === 'Individual' ? `${pkg.maxDuration} hours` : `Up to ${pkg.maxDuration} hours`) : 'N/A'}</p>
                  ${pkg.price ? `
                    <p><strong>Price:</strong> <span class="${priceClass}">$${pkg.price}</span>
                      ${pkg.originalPrice && discount ? ` <span class="original-price">(Reg. $${pkg.originalPrice})</span> <span class="discount">- ${discount}% OFF!</span>` : ''}
                    </p>
                  ` : ''}
                  ${pkg.equipment ? `
                    <p><strong>Services Included:</strong><br>
                    ${pkg.equipment.map(item => `<span class="equipment-tag">${item}</span>`).join('')}
                    </p>
                  ` : ''}
                  <${buttonTag} class="book-now-button" ${buttonAttributes}>Book Now</${buttonTag}>
                </div>
              `;
              container.appendChild(slide);
              slides.push(slide);
            });
          } else {
            // Toggle visibility of existing slides
            slides.forEach((slide, index) => {
              slide.classList.toggle('active', index === currentSlide);
            });
          }

          updateControls();
        }

        function updateControls() {
          prevButton.disabled = currentSlide === 0 || filteredPackages.length <= 1;
          nextButton.disabled = currentSlide === filteredPackages.length - 1 || filteredPackages.length <= 1;
          indicator.textContent = filteredPackages.length > 0 ? `${currentSlide + 1} of ${filteredPackages.length}` : '0 of 0';
        }

        prevButton.addEventListener('click', (e) => {
          e.preventDefault(); // Prevent any default navigation
          if (currentSlide > 0) {
            currentSlide--;
            console.log(`Previous slide for ${containerId}, new currentSlide: ${currentSlide}`);
            renderSlides();
          }
        });

        nextButton.addEventListener('click', (e) => {
          e.preventDefault(); // Prevent any default navigation
          if (currentSlide < filteredPackages.length - 1) {
            currentSlide++;
            console.log(`Next slide for ${containerId}, new currentSlide: ${currentSlide}`);
            renderSlides();
          }
        });

        window.addEventListener('resize', () => {
          renderSlides();
        });

        filterAndSortPackages();
        renderSlides();
      }
    });
  </script>
</body>
</html>
